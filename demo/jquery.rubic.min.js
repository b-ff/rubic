(function(e){jQuery.fn.rubic=function(t){function r(n){if(n.hasClass("overlay")){n.fadeOut(400,function(){n.remove()});return}var r=i(n);n.clone(true).insertAfter(n);n.css({position:"absolute",bottom:(t.rubicCount-r[0])*(t.itemSize+t.itemMargin)+t.itemMargin,right:(t.rubicCount-r[1])*(t.itemSize+t.itemMargin)+t.itemMargin,"z-index":200});n.addClass("overlay");if(r[1]-1>=0){var s=t.itemSize*r[1]+t.itemMargin*(r[1]-1);n.animate({width:s+"px"},200,function(){if(r[0]-1>=0){var i=t.itemSize*r[0]+t.itemMargin*(r[0]-1);n.animate({height:i+"px"},200,function(){n.css({top:"0px",left:"0px",bottom:"",right:""});if(t.rubicCount-r[1]>=0){var i=t.rubicCount*t.itemSize+t.itemMargin*(t.rubicCount-1);e("ul.rubic").find("li.overlay").animate({width:i},200,function(){console.log("Animation stage 2!"+e("ul.rubic").css("width"));if(t.rubicCount-r[0]>=0){var i=t.rubicCount*t.itemSize+t.itemMargin*(t.rubicCount-1);n.animate({height:i},200)}});n.children("span:first").animate({width:i-2*t.itemMargin+"px"},200)}})}});n.children("span:first").animate({width:s-2*t.itemMargin+"px"},200)}}function i(e){var t=e.attr("rel").split(",");var n=new Array(parseInt(t[0]),parseInt(t[1]));return n}function s(e){var n=0;for(var r=1;r<=t.rubicCount;r++){for(var i=1;i<=t.rubicCount;i++){e.children("li:eq("+n+")").attr("rel",r+","+i);n++}}}function o(e){if(parseInt(e)!=e){return false}else{return true}}t=e.extend({itemSize:150,itemMargin:5,rubicCount:Math.sqrt(this.children("li").size()),itemRadius:15},t);if(!o(t.rubicCount)){alert("Sorry, but plugin can't work with your number of items. (Must be 4,9,16,25...)");return}this.addClass("rubic");this.children("li").each(function(){e(this).css({"float":"left","background-image":'url("'+e(this).find("img:first").attr("src")+'")',width:t.itemSize+"px",height:t.itemSize+"px",marginRight:t.itemMargin+"px",marginBottom:t.itemMargin+"px",borderRadius:t.itemRadius+"px",position:"relative",cursor:"pointer"});e(this).addClass("rubic-item");e(this).find("img:first").remove();e(this).find("span").hide();e(this).find("span").css({position:"absolute",bottom:"0px",left:"0px","background-color":"rgba(0,0,0,0.5)",padding:"5px",color:"white","font-size":"11px",height:"50px",borderBottomLeftRadius:t.itemRadius+"px",borderBottomRightRadius:t.itemRadius+"px"});e(this).hover(function(){e(this).parent().children("li").each(function(){e(this).find("span:first").stop().fadeOut()});e(this).find("span:first").delay(300).fadeIn(400,function(){e(this).stop()})},function(){e(this).find("span:first").fadeOut(400)})});var n=(t.itemSize+t.itemMargin)*t.rubicCount+t.itemMargin;this.css({"list-style-type":"none","list-style-image":"none",width:n+"px",height:n+"px",margin:0,padding:0,overflow:"hidden",position:"relative"});s(this);this.children("li.rubic-item").on("click",function(){r(e(this))})}})(jQuery)